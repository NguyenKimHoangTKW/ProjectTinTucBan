@model IEnumerable<ProjectTinTucBan.Models.TaiKhoan>
@{
    ViewBag.Title = "Danh sách tài khoản";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}
<!-- page css -->
<link href="~/assets/vendors/datatables/dataTables.bootstrap.min.css" rel="stylesheet" />

<style>
    /* Đảm bảo các hàng dữ liệu có nền trắng và chữ dễ đọc */
    #data-table tbody tr {
        background-color: #ffffff !important;
        color: #212529 !important;
    }

        #data-table tbody tr td {
            color: #212529 !important;
        }

    /* Cố gắng hiển thị các thành phần điều khiển của DataTables nếu chúng bị ẩn */
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter,
    .dataTables_wrapper .dataTables_info,
    .dataTables_wrapper .dataTables_paginate {
        display: block !important; /* Hoặc 'flex', 'inline-block' tùy theo cấu trúc mong muốn */
        visibility: visible !important;
        opacity: 1 !important;
        padding-top: 10px; /* Thêm chút khoảng cách phía trên cho dễ nhìn */
        padding-bottom: 10px; /* Thêm chút khoảng cách phía dưới */
    }

    /* Căn chỉnh các thành phần điều khiển của DataTables giống ảnh mẫu hơn */
    .dataTables_wrapper .dataTables_length {
        float: left; /* Đưa "Show X entries" sang trái */
    }

    .dataTables_wrapper .dataTables_filter {
        float: right; /* Đưa ô tìm kiếm sang phải */
        text-align: right;
    }

    .dataTables_wrapper .dataTables_info {
        clear: both; /* Đảm bảo không bị ảnh hưởng bởi float ở trên */
        padding-top: 10px;
        float: left;
    }

    .dataTables_wrapper .dataTables_paginate {
        padding-top: 10px;
        float: right;
        text-align: right;
    }

    /* Clearfix cho các row chứa float elements */
    .dataTables_wrapper .row:after {
        content: "";
        display: table;
        clear: both;
    }

    /* Style cơ bản cho các nút phân trang giống Bootstrap */
    .dataTables_wrapper .dataTables_paginate .paginate_button {
        box-sizing: border-box;
        display: inline-block;
        min-width: 1.5em;
        padding: 0.5em 1em;
        margin-left: 2px;
        text-align: center;
        text-decoration: none !important;
        cursor: pointer;
        color: #007bff !important; /* Màu link Bootstrap */
        border: 1px solid transparent;
        border-radius: 0.25rem;
    }

        .dataTables_wrapper .dataTables_paginate .paginate_button.current,
        .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
            color: #fff !important;
            border: 1px solid #007bff;
            background-color: #007bff;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            color: #0056b3 !important;
            text-decoration: none !important;
            background-color: #e9ecef;
            border-color: #dee2e6;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button.disabled,
        .dataTables_wrapper .dataTables_paginate .paginate_button.disabled:hover,
        .dataTables_wrapper .dataTables_paginate .paginate_button.disabled:active {
            cursor: default;
            color: #6c757d !important;
            border: 1px solid transparent;
            background: transparent;
        }
</style>

<h2>Danh sách tài khoản</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

<div class="dataTables_wrapper dt-bootstrap4">
    <table id="data-table" class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Tên đăng nhập</th>
                <th>Email</th>
                <th>Số điện thoại</th>
                <th>Trạng thái</th>
                <th>Hành động</th> @* Thêm cột mới *@
            </tr>
        </thead>
        <tbody>
            @foreach (var acc in Model)
            {
                <tr>
                    <td>@acc.ID</td>
                    <td>@acc.TenTaiKhoan</td>
                    <td>@acc.Gmail</td>
                    <td>@acc.SDT</td>
                    <td>
                        @if (acc.IsBanned == true)
                        {
                            <span class="badge badge-danger">Bị khóa</span>
                        }
                        else
                        {
                            <span class="badge badge-success">Hoạt động</span>
                        }
                    </td>
                    <td>
                        @using (Html.BeginForm("ToggleBanStatus", "InterfaceAdmin", new { id = acc.ID }, FormMethod.Post, new { @style = "display:inline;" }))
                        {
                            @Html.AntiForgeryToken()
                            if (acc.IsBanned == true)
                            {
                                <button type="submit" class="btn btn-xs btn-success">Mở khóa</button>
                            }
                            else
                            {
                                <button type="submit" class="btn btn-xs btn-danger">Khóa</button>
                            }
                        }
                        @* Bạn có thể thêm các nút khác ở đây, ví dụ: Sửa, Xóa, Xem chi tiết *@
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section scriptsAdmin {
    <!-- page js -->
    <script src="~/assets/vendors/datatables/jquery.dataTables.min.js"></script>
    <script src="~/assets/vendors/datatables/dataTables.bootstrap.min.js"></script>
    <script>
        $(document).ready(function () {
            try {
                $('#data-table').DataTable({
                    "language": {
                        "url": "//cdn.datatables.net/plug-ins/1.10.20/i18n/Vietnamese.json"
                    },
                    "paging": true,
                    "searching": true,
                    "lengthChange": true,
                    "info": true,
                    "pageLength": 10,
                    "dom": "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
                        "<'row'<'col-sm-12'tr>>" +
                        "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
                    "columnDefs": [ // Đảm bảo cột Hành động không được sắp xếp hoặc tìm kiếm nếu không muốn
                        { "orderable": false, "targets": 5 }, // Giả sử cột Hành động là cột thứ 6 (index 5)
                        { "searchable": false, "targets": 5 }
                    ]
                });
            } catch (e) {
                console.error("Lỗi khi khởi tạo DataTable: ", e);
            }
        });
    </script>
}