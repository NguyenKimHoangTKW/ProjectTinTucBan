@model Newtonsoft.Json.Linq.JObject
@{
    ViewBag.Title = "Chỉnh sửa Footer";
}

@functions{
    public string GetEmbedUrl(string url)
    {
        if (string.IsNullOrEmpty(url)) return "";
        if (url.Contains("embed")) return url;
        var regex = new System.Text.RegularExpressions.Regex(@"(?:youtu\.be/|youtube\.com/(?:watch\?v=|embed/|v/|shorts/))([^\?&""'>]+)");
        var match = regex.Match(url);
        if (match.Success)
        {
            return "https://www.youtube.com/embed/" + match.Groups[1].Value;
        }
        return url;
    }
}

<h2>Chỉnh sửa Footer</h2>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

@using (Html.BeginForm("Edit", "Footer", FormMethod.Post, new { area = "Admin" }))
{
    @Html.AntiForgeryToken()
    <div class="form-group">
        <label>Tiêu đề (VN)</label>
        <input type="text" name="fullName" class="form-control" value="@Model["fullName"]" required />
    </div>
    <div class="form-group">
        <label>Tiêu đề (EN)</label>
        <input type="text" name="englishName" class="form-control" value="@Model["englishName"]" required />
    </div>
    <div class="form-group">
        <label>Ngày thành lập</label>
        <input type="text" name="established" class="form-control" value="@Model["established"]" required />
    </div>
    <div class="form-group">
        <label>Địa chỉ</label>
        <input type="text" name="address" class="form-control" value="@Model["address"]" required />
    </div>
    <div class="form-group">
        <label>Điện thoại</label>
        <input type="text" name="phone" class="form-control" value="@Model["phone"]" required />
    </div>
    <div class="form-group">
        <label>Email</label>
        <input type="email" name="email" class="form-control" value="@Model["email"]" required />
    </div>
    <div class="form-group">
        <label>Video URL (có thể dán link YouTube thường hoặc link nhúng)</label>
        <input type="text" name="videoUrl" class="form-control" value="@Model["videoUrl"]" />
    </div>
    <div class="form-group">
        <label>Bản quyền (footerCopyright)</label>
        <input type="text" name="footerCopyright" class="form-control" value="@Model["footerCopyright"]" />
    </div>
    <div class="form-group">
        <label>Ghi chú (footerNote)</label>
        <input type="text" name="footerNote" class="form-control" value="@Model["footerNote"]" />
    </div>
    <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
}

@if (!string.IsNullOrEmpty((string)Model["videoUrl"]))
{
    <div class="mt-3">
        <label>Xem trước video:</label>
        <div>
            <iframe width="560" height="315" src="@GetEmbedUrl((string)Model["videoUrl"])" frameborder="0" allowfullscreen></iframe>
        </div>
    </div>
}